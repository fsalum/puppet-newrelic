#
# New Relic Server Monitor configuration file.
#
# Lines that begin with a # are comment lines and are ignored by the server
# monitor. For those options that have command line equivalents, if the
# option is specified on the command line it will over-ride any value set
# in this file.
#

#
# Option : license_key
# Value  : 40-character hexadecimal string provided by New Relic. This is
#          required in order for the server monitor to start.
# Default: none
#
license_key=<%= @newrelic_license_key %>

#
# Option : loglevel
# Value  : Level of detail you want in the log file (as defined by the logfile
#          setting below. Valid values are (in increasing levels of verbosity):
#          error        - show errors only
#          warning      - show errors and warnings
#          info         - show minimal additional information messages
#          verbose      - show more detailed information messages
#          debug        - show debug messages
#          verbosedebug - show very detailed debug messages
# Default: info
# Note   : Can also be set with the -d command line option.
#
<%- if @newrelic_nrsysmond_loglevel -%>
loglevel=<%= @newrelic_nrsysmond_loglevel %>
<%- else -%>
loglevel=info
<%- end -%>

#
# Option : logfile
# Value  : Name of the file where the server monitor will store it's log
#          messages. The amount of detail stored in this file is controlled
#          by the loglevel option (above).
# Default: none. However it is highly recommended you set a value for this.
# Note   : Can also be set with the -l command line option.
#
<%- if @newrelic_nrsysmond_logfile -%>
logfile=<%= @newrelic_nrsysmond_logfile %>
<%- else -%>
logfile=/var/log/newrelic/nrsysmond.log
<%- end -%>

#
# Option : proxy
# Value  : The name and optional login credentials of the proxy server to use
#          for all communication with the New Relic collector. In its simplest
#          form this setting is just a hostname[:port] setting. The default
#          port if none is specified is 1080. If your proxy requires a user
#          name, use the syntax user@host[:port]. If it also requires a
#          password use the format user:password@host[:port]. For example:
#            fred:secret@proxy.mydomain.com:8181
# Default: none (use a direct connection)
#
<%- if @newrelic_nrsysmond_proxy -%>
proxy=<%= @newrelic_nrsysmond_proxy %>
<%- end -%>

#
# Setting: ssl
# Type   : boolean
# Purpose: If you prefer the daemon to use the secure HTTP (https) protocol
#          when communicating with the New Relic collector servers, set this
#          to true.
# Default: true (as of version 1.4)
#
<%- if @newrelic_nrsysmond_ssl -%>
ssl=<%= @newrelic_nrsysmond_ssl %>
<%- end -%>

#
# Setting: hostname
# Type   : string
# Purpose: Sets the name of the host (max 64 characters) that you wish to use
#          for reporting. This is usually determined automatically on startup
#          but you may want to change it if, for example, you have machine
#          generated hostnames that are not visually useful (for example, the
#          names generated by Docker containers).
# Default: The system configured host name
#
<%- if @newrelic_nrsysmond_hostname -%>
hostname=<%= @newrelic_nrsysmond_hostname %>
<%- end -%>

#
# Setting: docker_connection
# Type   : string
# Purpose: Determine how to communicate with the Docker API on the local host.
#          Valid values are:
#
#          uds:///path/to/socket
#          unix:///path/to/socket
#          /path/to/socket
#            These three forms are all equivalent and are used to point to the
#            UNIX-domain socket (UDS). The socket path must be absolute and the
#            socket must be writeable.
#
#          tcp://localhost:port
#          http://localhost:port
#            Use an unencrypted connection to the local host on the specified
#            port. If the :port portion is missing it defaults to 2376. The
#            host name MUST be localhost or 127.0.0.1. No other host name is
#            valid.
#
#          https://localhost:port
#            Use an encrypted connection to the local host om the specified
#            port. If the :port portion is missing it defaults to 2376. The
#            host name MUST be localhost or 127.0.0.1. No other host name is
#            valid. In order to use TLS authentication you may need to set
#            the various key and certificate options below.
#
#          If no value is set, attempt to use the default (/var/run/docker.sock)
#          if it exists and is writable. If that fails, attempt to use the value
#          of the environment variable DOCKER_HOST.
#
#          You may need to add the user that you run LSM as to the docker
#          group. Please consult the Docker web site for details and security
#          implications.
# Default: empty
<%- if @newrelic_nrsysmond_docker_connection -%>
docker_connection=<%= @newrelic_nrsysmond_docker_connection %>
<%- end -%>

#
# Setting: docker_cert_path
# Type   : string
# Purpose: Set the default location to look for the certificate, key and CA
#          certificate for using TLS. If no value is set and the directory
#          $HOME/.docker exists, that is used as the default value. LSM will
#          look in this directory for the cert.pem, key.pem and cacert.pem
#          files, and use them if present. If set, the environment variable
#          $DOCKER_CERT_PATH will be used as the default value if no value
#          is explicitly set here.
# Default: empty
<%- if @newrelic_nrsysmond_docker_cert_path -%>
docker_cert_path=<%= @newrelic_nrsysmond_docker_cert_path %>
<%- end -%>

#
# Setting: docker_cert
#          docker_key
#          docker_cacert
# Type   : string
# Purpose: Set the name of the certificate, key and CA certificate files to
#          use for TLS. If these are not absolute paths they are searched for
#          in the directory determined by docker_cert_path above.
# Default: empty
<%- if @newrelic_nrsysmond_docker_cert -%>
docker_cert=<%= @newrelic_nrsysmond_docker_cert %>
<%- end -%>
<%- if @newrelic_nrsysmond_docker_key -%>
docker_key=<%= @newrelic_nrsysmond_docker_key %>
<%- end -%>
<%- if @newrelic_nrsysmond_docker_cacert -%>
docker_cacert=<%= @newrelic_nrsysmond_docker_cacert %>
<%- end -%>

#
# Setting: ssl_ca_bundle
# Type   : string
# Purpose: Sets the location of a file containing CA certificates in PEM
#          format. When set, the certificates in this file will be used
#          to authenticate the New Relic collector servers. If ssl_ca_path
#          is also set (see below), the certificates in this file will be
#          searched first, followed by the certificates contained in the
#          ssl_ca_path directory. This setting has no effect when ssl
#          is set to false.
# Default: none
# Note   : Can also be set with the -b command line option.
#
<%- if @newrelic_nrsysmond_ssl_ca_bundle -%>
ssl_ca_bundle=<%= @newrelic_nrsysmond_ssl_ca_bundle %>
<%- end -%>

#
# Setting: ssl_ca_path
# Type   : string
# Purpose: Sets the location of a directory containing trusted CA certificates
#          in PEM format. When set, the certificates in this directory will be
#          used to authenticate the New Relic collector servers. If
#          ssl_ca_bundle is also set (see above), it will be searched first
#          followed by the certificates contained in ssl_ca_path. This
#          setting has no effect when ssl is set to false.
# Default: none
# Note   : Can also be set with the -S command line option.
#
<%- if @newrelic_nrsysmond_ssl_ca_path -%>
ssl_ca_path=<%= @newrelic_nrsysmond_ssl_ca_path %>
<%- end -%>

#
# Option : pidfile
# Value  : Name of a file where the server monitoring daemon will store it's
#          process ID (PID). This is used by the startup and shutdown script
#          to determine if the monitor is already running, and to start it up
#          or shut it down.
# Default: /tmp/nrsysmond.pid
# Note   : Can also be set with the -p command line option.
#
<%- if @newrelic_nrsysmond_pidfile -%>
pidfile=<%= @newrelic_nrsysmond_pidfile %>
<%- end -%>

#
# Option : collector_host
# Value  : The name of the New Relic collector to connect to. This should only
#          ever be changed on advise from a New Relic support staff member.
#          The format is host[:port]. Using a port number of 0 means the default
#          port, which is 80 (if not using the ssl option - see below) or 443
#          if SSL is enabled. If the port is omitted the default value is used.
# Default: collector.newrelic.com
#
<%- if @newrelic_nrsysmond_collector_host -%>
collector_host=<%= @newrelic_nrsysmond_collector_host %>
<%- end -%>

#
# Option : labels
# Value  : A series of label_type/label_value pairings
#          Each item in the pair is separated by a colon
#          Each pair is separated by a semicolon
#          e.g.
#            labels = Environment:Production;DataCenter:EastUS;
# Default: none
#
<%- if @newrelic_nrsysmond_labels -%>
labels=<%= @newrelic_nrsysmond_labels %>
<%- end -%>

#
# Option : timeout
# Value  : How long the monitor should wait to contact the collector host. If
#          the connection cannot be established in this period of time, the
#          monitor will progressively back off in 15-second increments, up to
#          a maximum of 300 seconds. Once the initial connection has been
#          established, this value is reset back to the value specified here
#          (or the default). This then sets the maximum time to wait for
#          a connection to the collector to report data. There is no back-off
#          once the original connection has been made. The value is in seconds.
# Default: 30
#
<%- if @newrelic_nrsysmond_timeout -%>
timeout=<%= @newrelic_nrsysmond_timeout %>
<%- end -%>

#
# Option : disable_nfs
# Type   : boolean
# Value  : Set to true to disable NFS client statistics gathering.
# Default: false
#
<%- if @newrelic_nrsysmond_disable_nfs -%>
disable_nfs=<%= @newrelic_nrsysmond_disable_nfs %>
<%- end -%>

#
# Option : disable_docker
# Type   : boolean
# Value  : Set to true to disable Docker container statistics gathering.
# Default: false
#
<%- if @newrelic_nrsysmond_disable_docker -%>
disable_docker=<%= @newrelic_nrsysmond_disable_docker %>
<%- end -%>

#
# Option : cgroup_root
# Type   : string
# Value  : Set to the top level mount point for CGroup data files. Usually
#          the daemon will auto-detect this but you can provide a specific
#          path if, for example, you have multiple CGroup mounts.
# Default: Distribution dependent, but usually /sys/fs/cgroup or /cgroup.
<%- if @newrelic_nrsysmond_cgroup_root -%>
cgroup_root=<%= @newrelic_nrsysmond_cgroup_root %>
<%- end -%>

#
# Option : cgroup_style
# Type   : integer
# Value  : By default, the CPU and Memory stats collected per container are recorded from:
#          /sys/fs/cgroup/cpu/system.slice/docker-{container_id}/cpu.stat
#          /sys/fs/cgroup/memory/system.slice/docker-{container_id}/memory.stat
#          However, some Linux distributions customize this path, typically at:
#          /sys/fs/cgroup/memory/docker/{container_id}/memory.stat
#          /sys/fs/cgroup/cpu/docker/{container_id}/cpu.stat
#          To use this path instead, add the following command to nrsysmond.cfg,
#          then restart the server monitor to apply the change:
#          cgroup_style=0
# Default: none
<%- if @newrelic_nrsysmond_cgroup_style -%>
cgroup_style=<%= @newrelic_nrsysmond_cgroup_style %>
<%- end -%>


#
# Option : ignore_reclaimable
# Type   : boolean
# Value  : Set to true if the memory the kernel refers to as "reclaimable
#          slabs" should be ignored when calculating how much RAM is in
#          use. The default for this value changed in version 2.1.1 from
#          false to true. Setting this to true gives a more accurate picture
#          of how much RAM is in use but will cause a sudden drop in RAM used
#          when first upgrading to version 2.1.1.
# Default: true
<%- if @newrelic_nrsysmond_ignore_reclaimable -%>
ignore_reclaimable=<%= @newrelic_nrsysmond_ignore_reclaimable %>
<%- end -%>

#
# Option : host_root
# Type   : string
# Value  : Set to the name of a directory in which the real host's /proc,
#          /dev and /sys filesystems are mounted. This is useful mainly for
#          running nrsysmond inside a Docker container, for example under
#          CoreOS. Docker provides its own view of /proc and /sys in
#          particular, and nrsysmond needs the system wide versions of these
#          filesystems, not the limited container view. The most common thing
#          to do is to mount these all under a directory called /host. In this
#          case you would set this value to /host. That means that /host/proc
#          will refer to the real underlying system's /proc, /host/sys will
#          refer to /sys etc.
# Default: None.
<%- if @newrelic_nrsysmond_host_root -%>
host_root=<%= @newrelic_nrsysmond_host_root %>
<%- end -%>
